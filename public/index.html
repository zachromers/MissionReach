<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionReach</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <nav class="top-nav">
    <a href="#" class="nav-brand" id="nav-brand-link">MissionReach</a>
    <div class="nav-tabs">
      <button class="nav-tab active" data-tab="home">Home</button>
      <button class="nav-tab" data-tab="contacts">Contacts</button>
      <button class="nav-tab" data-tab="search">Search</button>
      <button class="nav-tab" data-tab="import">Import</button>
      <button class="nav-tab" data-tab="settings">Settings</button>
    </div>
  </nav>

  <main class="content">
    <!-- HOME PAGE -->
    <section id="page-home" class="page active">
      <div class="carousel-toolbar">
        <button class="btn btn-sm" id="carousel-sort-toggle">Warmth: High â†’ Low</button>
      </div>
      <div class="contact-carousel-wrapper">
        <button class="carousel-arrow carousel-arrow-left" id="carousel-left" aria-label="Scroll left">&#8249;</button>
        <div class="contact-carousel" id="contact-carousel"></div>
        <button class="carousel-arrow carousel-arrow-right" id="carousel-right" aria-label="Scroll right">&#8250;</button>
      </div>

      <p id="warmth-status" class="hidden" style="text-align:center;color:var(--gray-400);font-size:13px;margin-bottom:12px;">Updating warmth scores...</p>
      <div class="prompt-section">
        <h1>Recommended Outreach for Today</h1>

        <div class="daily-prompt" id="daily-chips"></div>

        <p class="subtitle">If you would like to create custom outreach recommendation, enter a population filter below</p>
        <textarea id="ai-prompt" placeholder='e.g. "Who used to donate monthly but stopped in the last 6 months?"' rows="4"></textarea>
        <button id="btn-generate" class="btn btn-primary">Generate Recommendations</button>
        <p id="model-indicator" class="model-indicator"></p>

        <div id="ai-results" class="ai-results hidden">
          <div class="results-header">
            <h2>Recommended Contacts <span id="results-count" class="badge"></span></h2>
            <div class="bulk-actions">
              <button id="btn-log-all" class="btn btn-sm">Log All as Outreach</button>
              <button id="btn-export-drafts" class="btn btn-sm">Export Drafts</button>
            </div>
          </div>
          <div id="results-cards"></div>
          <div id="load-more-wrap" class="hidden" style="text-align:center;margin:20px 0;">
            <button id="btn-load-more" class="btn">Load More Recommendations</button>
            <div id="load-more-loading" class="hidden" style="margin-top:8px;">
              <div class="spinner"></div>
              <p>Loading more recommendations...</p>
            </div>
          </div>
          <details class="reasoning-section">
            <summary>AI Reasoning</summary>
            <p id="ai-reasoning"></p>
          </details>
        </div>

        <div id="ai-loading" class="hidden">
          <div class="spinner"></div>
          <p>Analyzing your contacts and generating recommendations...</p>
        </div>

        <div id="ai-error" class="hidden error-message"></div>
      </div>
    </section>

    <!-- CONTACTS PAGE -->
    <section id="page-contacts" class="page">
      <div class="contacts-header">
        <div class="contacts-search-row">
          <input type="text" id="contacts-search" placeholder="Search contacts..." class="search-input">
          <button id="btn-export-csv" class="btn btn-sm">Export Contacts</button>
          <button id="btn-find-duplicates" class="btn btn-sm">Check for Duplicates</button>
          <button id="btn-add-contact" class="btn btn-primary">Add New Contact</button>
        </div>
        <div class="tag-filters" id="tag-filters"></div>
      </div>
      <div class="top-scroll" id="contacts-top-scroll"><div></div></div>
      <div class="contacts-table-wrap" id="contacts-table-wrap">
        <table class="contacts-table">
          <thead>
            <tr>
              <th data-sort="last_name">Name</th>
              <th>Warmth</th>
              <th data-sort="email">Email</th>
              <th>Phone</th>
              <th data-sort="last_outreach_date">Last Contact</th>
              <th data-sort="last_donation_date">Last Donation</th>
              <th>Tags</th>
            </tr>
          </thead>
          <tbody id="contacts-tbody"></tbody>
        </table>
      </div>
    </section>

    <!-- SEARCH PAGE -->
    <section id="page-search" class="page">
      <div class="search-header">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px;">
          <h2 style="font-size:20px;margin:0;">Search Contacts <span id="search-count" class="badge">0</span></h2>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button id="btn-search-export-csv" class="btn btn-sm">Export CSV</button>
            <button id="btn-search-copy-emails" class="btn btn-sm">Copy Emails</button>
            <button id="btn-search-copy-phones" class="btn btn-sm">Copy Phones</button>
            <button id="btn-search-clear" class="btn btn-sm">Clear Filters</button>
          </div>
        </div>
      </div>
      <div class="top-scroll" id="search-top-scroll"><div></div></div>
      <div class="search-table-wrap" id="search-table-wrap">
        <table class="search-table">
          <thead>
            <tr class="search-col-headers">
              <th data-sort="last_name">Name</th>
              <th>Warmth</th>
              <th data-sort="email">Email</th>
              <th data-sort="phone">Phone</th>
              <th data-sort="city">City</th>
              <th data-sort="state">State</th>
              <th data-sort="organization">Organization</th>
              <th data-sort="relationship">Relationship</th>
              <th>Tags</th>
              <th data-sort="last_outreach_date">Last Contact</th>
              <th data-sort="last_donation_date">Last Donation</th>
              <th data-sort="total_donated">Total Donated</th>
            </tr>
            <tr class="search-filter-row">
              <td><input type="text" class="filter-input" data-filter="name_filter" placeholder="Name..."></td>
              <td></td>
              <td><input type="text" class="filter-input" data-filter="email_filter" placeholder="Email..."></td>
              <td><input type="text" class="filter-input" data-filter="phone_filter" placeholder="Phone..."></td>
              <td><input type="text" class="filter-input" data-filter="city" placeholder="City..."></td>
              <td><input type="text" class="filter-input" data-filter="state" placeholder="State..."></td>
              <td><input type="text" class="filter-input" data-filter="organization" placeholder="Org..."></td>
              <td><input type="text" class="filter-input" data-filter="relationship" placeholder="Rel..."></td>
              <td></td>
              <td>
                <div class="filter-date-range">
                  <input type="date" class="filter-input" data-filter="outreach_from" title="From">
                  <input type="date" class="filter-input" data-filter="outreach_to" title="To">
                  <span class="filter-date-hint" id="hint-outreach"></span>
                </div>
              </td>
              <td>
                <div class="filter-date-range">
                  <input type="date" class="filter-input" data-filter="donation_from" title="From">
                  <input type="date" class="filter-input" data-filter="donation_to" title="To">
                  <span class="filter-date-hint" id="hint-donation"></span>
                </div>
              </td>
              <td>
                <div class="filter-range">
                  <input type="number" class="filter-input" data-filter="total_donated_min" placeholder="Min" step="0.01">
                  <input type="number" class="filter-input" data-filter="total_donated_max" placeholder="Max" step="0.01">
                  <span class="filter-date-hint" id="hint-donated"></span>
                </div>
              </td>
            </tr>
          </thead>
          <tbody id="search-tbody"></tbody>
        </table>
      </div>
    </section>

    <!-- IMPORT PAGE -->
    <section id="page-import" class="page">
      <div class="import-section">
        <div id="import-step1">
          <h2>Import Contacts</h2>
          <p>Upload a CSV or Excel file to import contacts.</p>
          <div class="drop-zone" id="drop-zone">
            <p>Drag & drop a file here, or click to select</p>
            <p class="drop-hint">Accepts .csv, .xlsx, .xls files</p>
            <input type="file" id="import-file" accept=".csv,.xlsx,.xls" hidden>
          </div>
          <button id="btn-upload-preview" class="btn btn-primary" disabled>Upload & Preview</button>
        </div>

        <div id="import-step2" class="hidden">
          <h2>Preview & Map Columns</h2>
          <p id="import-summary"></p>
          <div class="preview-table-wrap">
            <table class="preview-table" id="preview-table"></table>
          </div>
          <button id="btn-import-execute" class="btn btn-primary">Import Contacts</button>
          <button id="btn-import-back" class="btn">Back</button>

          <div class="import-preview-section">
            <h3>Import Preview</h3>
            <p class="import-preview-hint">This is how your contacts will appear after import.</p>
            <div class="import-preview-table-wrap">
              <table class="search-table import-preview-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Organization</th>
                    <th>Relationship</th>
                    <th>Tags</th>
                    <th>Last Contact</th>
                    <th>Last Donation</th>
                    <th>Total Donated</th>
                  </tr>
                </thead>
                <tbody id="import-preview-tbody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="import-step3" class="hidden">
          <h2>Import Complete</h2>
          <div id="import-results"></div>
          <button id="btn-goto-contacts" class="btn btn-primary">Go to Contacts</button>
        </div>
      </div>
    </section>

    <!-- SETTINGS PAGE -->
    <section id="page-settings" class="page">
      <div class="settings-section">
        <h2>Settings</h2>
        <form id="settings-form">
          <div class="form-group">
            <label for="setting-name">Your Name</label>
            <input type="text" id="setting-name" placeholder="Your full name">
          </div>
          <div class="form-group">
            <label for="setting-context">Mission Context</label>
            <textarea id="setting-context" rows="4" placeholder="Describe your mission, ministry, or organization in a few sentences. This helps the AI write more personalized messages."></textarea>
          </div>
          <div class="form-group">
            <label for="setting-model">AI Model</label>
            <select id="setting-model">
              <option value="haiku">Claude Haiku (fastest, lowest cost)</option>
              <option value="sonnet" selected>Claude Sonnet (balanced)</option>
              <option value="opus">Claude Opus (most capable)</option>
            </select>
            <small>Choose which Claude model generates your recommendations.</small>
          </div>
          <div class="form-group">
            <label for="setting-stale-days">Default Stale Contact Threshold (days)</label>
            <input type="number" id="setting-stale-days" value="90" min="1">
            <small>Contacts with no outreach in this many days will be flagged.</small>
          </div>
          <button type="submit" class="btn btn-primary">Save Settings</button>
          <div id="settings-message" class="hidden"></div>
        </form>

        <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--gray-200);">

        <h3 style="margin-bottom: 8px;">Warmth Scores</h3>
        <p style="color: var(--gray-400); font-size: 14px; margin-bottom: 16px;">Force a recalculation of warmth scores for all contacts, regardless of when they were last calculated.</p>
        <button id="btn-recalculate-warmth" class="btn btn-primary">Recalculate All Warmth Scores</button>
        <div id="recalculate-warmth-status" class="hidden" style="margin-top: 12px;"></div>
      </div>
    </section>
  </main>

  <!-- CONTACT DETAIL MODAL -->
  <div id="contact-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h2 id="modal-title">Contact Details</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <!-- OUTREACH LOG MODAL -->
  <div id="outreach-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel modal-sm">
      <div class="modal-header">
        <h2>Log Outreach</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="outreach-form">
          <input type="hidden" id="outreach-contact-id">
          <input type="hidden" id="outreach-contact-email">
          <div class="form-group">
            <label for="outreach-mode">Mode</label>
            <select id="outreach-mode">
              <option value="email">Email</option>
              <option value="sms">SMS</option>
              <option value="call">Call</option>
              <option value="letter">Letter</option>
              <option value="in_person">In Person</option>
              <option value="social_media">Social Media</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="outreach-subject">Subject</label>
            <input type="text" id="outreach-subject">
          </div>
          <div class="form-group">
            <label for="outreach-content">Content</label>
            <textarea id="outreach-content" rows="4"></textarea>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
            <button type="submit" class="btn btn-primary">Log Outreach</button>
            <a id="btn-send-email" class="btn send-email-btn hidden" href="#" target="_blank" title="Open in your email client">Send Email</a>
            <button type="button" class="btn" id="btn-generate-outreach">Generate Recommended Outreach</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="js/utils.js"></script>
  <script src="js/home.js"></script>
  <script src="js/contacts.js"></script>
  <script src="js/search.js"></script>
  <script src="js/import.js"></script>
  <script src="js/settings.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
