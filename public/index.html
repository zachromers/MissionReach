<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0f172a">
  <title>MissionReach</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

  <!-- LOGIN PAGE -->
  <div id="login-page" class="login-page hidden">
    <div class="login-card">
      <h1 class="login-brand">MissionReach</h1>
      <p class="login-subtitle">Sign in to your account</p>
      <form id="login-form">
        <div class="form-group">
          <label for="login-username">Username</label>
          <input type="text" id="login-username" autocomplete="username" autofocus>
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" autocomplete="current-password">
        </div>
        <button type="submit" class="btn btn-primary login-btn">Sign In</button>
        <div id="login-error" class="login-error hidden"></div>
      </form>
      <p class="login-toggle">Don't have an account? <a href="#" id="link-show-register">Create Account</a></p>
    </div>
  </div>

  <!-- REGISTRATION PAGE -->
  <div id="register-page" class="login-page hidden">
    <div class="login-card">
      <h1 class="login-brand">MissionReach</h1>
      <p class="login-subtitle">Create a new account</p>
      <form id="register-form">
        <div class="form-group">
          <label for="register-display-name">Display Name</label>
          <input type="text" id="register-display-name" autocomplete="name" required maxlength="128">
          <small class="field-error hidden" id="error-display-name"></small>
        </div>
        <div class="form-group">
          <label for="register-email">Email</label>
          <input type="email" id="register-email" autocomplete="email" required maxlength="255">
          <small class="field-error hidden" id="error-email"></small>
        </div>
        <div class="form-group">
          <label for="register-username">Username</label>
          <input type="text" id="register-username" autocomplete="username" required maxlength="64">
          <small class="field-error hidden" id="error-username"></small>
        </div>
        <div class="form-group">
          <label for="register-password">Password</label>
          <input type="password" id="register-password" autocomplete="new-password" required>
          <small class="field-hint" id="hint-password">Minimum 6 characters.</small>
          <small class="field-error hidden" id="error-password"></small>
        </div>
        <div class="form-group">
          <label for="register-confirm-password">Confirm Password</label>
          <input type="password" id="register-confirm-password" autocomplete="new-password" required>
          <small class="field-error hidden" id="error-confirm-password"></small>
        </div>
        <button type="submit" class="btn btn-primary login-btn">Create Account</button>
        <div id="register-error" class="login-error hidden"></div>
      </form>
      <p class="login-toggle"><a href="#" id="link-show-login">Back to Sign In</a></p>
    </div>
  </div>

  <!-- FORCE PASSWORD CHANGE PAGE -->
  <div id="force-password-page" class="login-page hidden">
    <div class="login-card">
      <h1 class="login-brand">MissionReach</h1>
      <p class="login-subtitle">You must change your password before continuing</p>
      <form id="force-password-form">
        <div class="form-group">
          <label for="force-current-password">Current Password</label>
          <input type="password" id="force-current-password" autocomplete="current-password">
        </div>
        <div class="form-group">
          <label for="force-new-password">New Password</label>
          <input type="password" id="force-new-password" autocomplete="new-password">
          <small>Minimum 6 characters.</small>
        </div>
        <div class="form-group">
          <label for="force-confirm-password">Confirm New Password</label>
          <input type="password" id="force-confirm-password" autocomplete="new-password">
        </div>
        <button type="submit" class="btn btn-primary login-btn">Change Password</button>
        <div id="force-password-error" class="login-error hidden"></div>
      </form>
    </div>
  </div>

  <!-- APP SHELL (hidden until authenticated) -->
  <div id="app-shell" class="hidden">

    <!-- Default password warning banner -->
    <div id="default-password-banner" class="default-password-banner hidden">
      <span>You are using the default admin password. Please change it in Profile for security.</span>
      <button class="btn btn-sm" id="btn-change-password-banner">Change Password</button>
    </div>

    <nav class="top-nav">
      <a href="#" class="nav-brand" id="nav-brand-link">MissionReach</a>
      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="home">
          <svg class="nav-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
          <span class="nav-label">Home</span>
        </button>
        <button class="nav-tab" data-tab="contacts">
          <svg class="nav-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
          <span class="nav-label">Contacts</span>
        </button>
        <button class="nav-tab" data-tab="search">
          <svg class="nav-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
          <span class="nav-label">Search</span>
        </button>
        <button class="nav-tab" data-tab="import">
          <svg class="nav-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/></svg>
          <span class="nav-label">Import</span>
        </button>
        <button class="nav-tab" data-tab="settings">
          <svg class="nav-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
          <span class="nav-label">Settings</span>
        </button>
        <button class="nav-tab" data-tab="profile">
          <svg class="nav-icon" viewBox="0 0 16 16"><path fill="currentColor" d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/></svg>
          <span class="nav-label">Profile</span>
        </button>
        <button class="nav-tab hidden" data-tab="admin" id="nav-tab-admin">
          <svg class="nav-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
          <span class="nav-label">Admin</span>
        </button>
      </div>
      <div class="nav-user-menu">
        <span id="nav-user-display" class="nav-user-name"></span>
        <button class="btn btn-sm nav-logout-btn" id="btn-logout">Logout</button>
      </div>
    </nav>

    <main class="content">
      <!-- HOME PAGE -->
      <section id="page-home" class="page active">
        <div class="carousel-toolbar">
          <button class="btn btn-sm" id="carousel-sort-toggle">Warmth: High â†’ Low</button>
        </div>
        <div class="contact-carousel-wrapper">
          <button class="carousel-arrow carousel-arrow-left" id="carousel-left" aria-label="Scroll left">&#8249;</button>
          <div class="contact-carousel" id="contact-carousel"></div>
          <button class="carousel-arrow carousel-arrow-right" id="carousel-right" aria-label="Scroll right">&#8250;</button>
        </div>

        <p id="warmth-status" class="hidden" style="text-align:center;color:var(--gray-400);font-size:13px;margin-bottom:12px;">Updating warmth scores...</p>
        <div class="prompt-section">
          <h1>Recommended Outreach for Today</h1>

          <div class="daily-prompt" id="daily-chips"></div>

          <p class="subtitle">If you would like to create custom outreach recommendation, enter a population filter below</p>
          <textarea id="ai-prompt" placeholder='e.g. "Who used to donate monthly but stopped in the last 6 months?"' rows="4"></textarea>
          <button id="btn-generate" class="btn btn-primary">Generate Recommendations</button>
          <p id="model-indicator" class="model-indicator"></p>

          <div id="ai-results" class="ai-results hidden">
            <div class="results-header">
              <h2>Recommended Contacts <span id="results-count" class="badge"></span></h2>
              <div class="bulk-actions">
                <button id="btn-log-all" class="btn btn-sm">Log All as Outreach</button>
                <button id="btn-export-drafts" class="btn btn-sm">Export Drafts</button>
              </div>
            </div>
            <div id="results-cards"></div>
            <div id="load-more-wrap" class="hidden" style="text-align:center;margin:20px 0;">
              <button id="btn-load-more" class="btn">Load More Recommendations</button>
              <div id="load-more-loading" class="hidden" style="margin-top:8px;">
                <div class="spinner"></div>
                <p>Loading more recommendations...</p>
              </div>
            </div>
            <details class="reasoning-section">
              <summary>AI Reasoning</summary>
              <p id="ai-reasoning"></p>
            </details>
          </div>

          <div id="ai-loading" class="hidden">
            <div class="spinner"></div>
            <p>Analyzing your contacts and generating recommendations...</p>
          </div>

          <div id="ai-error" class="hidden error-message"></div>
        </div>
      </section>

      <!-- CONTACTS PAGE -->
      <section id="page-contacts" class="page">
        <div class="contacts-header">
          <div class="contacts-search-row">
            <input type="text" id="contacts-search" placeholder="Search contacts..." class="search-input">
            <button id="btn-export-csv" class="btn btn-sm">Export Contacts</button>
            <button id="btn-find-duplicates" class="btn btn-sm">Check for Duplicates</button>
            <button id="btn-add-contact" class="btn btn-primary">Add New Contact</button>
          </div>
          <div class="tag-filters" id="tag-filters"></div>
        </div>
        <div class="top-scroll" id="contacts-top-scroll"><div></div></div>
        <div class="contacts-table-wrap" id="contacts-table-wrap">
          <table class="contacts-table">
            <thead>
              <tr>
                <th data-sort="last_name">Name</th>
                <th>Warmth</th>
                <th data-sort="email">Email</th>
                <th>Phone</th>
                <th data-sort="last_outreach_date">Last Contact</th>
                <th data-sort="last_donation_date">Last Donation</th>
                <th>Tags</th>
              </tr>
            </thead>
            <tbody id="contacts-tbody"></tbody>
          </table>
        </div>
        <div id="contacts-pagination"></div>
      </section>

      <!-- SEARCH PAGE -->
      <section id="page-search" class="page">
        <div class="search-header">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px;">
            <h2 style="font-size:20px;margin:0;">Search Contacts <span id="search-count" class="badge">0</span></h2>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <button id="btn-search-export-csv" class="btn btn-sm">Export CSV</button>
              <button id="btn-search-copy-emails" class="btn btn-sm">Copy Emails</button>
              <button id="btn-search-copy-phones" class="btn btn-sm">Copy Phones</button>
              <button id="btn-search-clear" class="btn btn-sm">Clear Filters</button>
            </div>
          </div>
        </div>
        <div class="top-scroll" id="search-top-scroll"><div></div></div>
        <div class="search-table-wrap" id="search-table-wrap">
          <table class="search-table">
            <thead>
              <tr class="search-col-headers">
                <th data-sort="last_name">Name</th>
                <th data-sort="warmth_score">Warmth</th>
                <th data-sort="email">Email</th>
                <th data-sort="phone">Phone</th>
                <th data-sort="city">City</th>
                <th data-sort="state">State</th>
                <th data-sort="organization">Organization</th>
                <th data-sort="relationship">Relationship</th>
                <th data-sort="tags">Tags</th>
                <th data-sort="last_outreach_date">Last Contact</th>
                <th data-sort="last_donation_date">Last Donation</th>
                <th data-sort="total_donated">Total Donated</th>
              </tr>
              <tr class="search-filter-row">
                <td><input type="text" class="filter-input" data-filter="name_filter" placeholder="Name..."></td>
                <td>
                  <div class="warmth-multiselect" data-filter="warmth_scores">
                    <button type="button" class="filter-input warmth-multiselect-btn">All</button>
                    <div class="warmth-multiselect-dropdown">
                      <label><input type="checkbox" value="1"><span class="warmth-badge warmth-1">1</span></label>
                      <label><input type="checkbox" value="2"><span class="warmth-badge warmth-2">2</span></label>
                      <label><input type="checkbox" value="3"><span class="warmth-badge warmth-3">3</span></label>
                      <label><input type="checkbox" value="4"><span class="warmth-badge warmth-4">4</span></label>
                      <label><input type="checkbox" value="5"><span class="warmth-badge warmth-5">5</span></label>
                    </div>
                  </div>
                </td>
                <td><input type="text" class="filter-input" data-filter="email_filter" placeholder="Email..."></td>
                <td><input type="text" class="filter-input" data-filter="phone_filter" placeholder="Phone..."></td>
                <td><input type="text" class="filter-input" data-filter="city" placeholder="City..."></td>
                <td><input type="text" class="filter-input" data-filter="state" placeholder="State..."></td>
                <td><input type="text" class="filter-input" data-filter="organization" placeholder="Org..."></td>
                <td><input type="text" class="filter-input" data-filter="relationship" placeholder="Rel..."></td>
                <td class="search-tag-filter-cell"><div id="search-tag-picker"></div></td>
                <td>
                  <div class="filter-date-range">
                    <input type="date" class="filter-input" data-filter="outreach_from" title="From">
                    <input type="date" class="filter-input" data-filter="outreach_to" title="To">
                    <span class="filter-date-hint" id="hint-outreach"></span>
                  </div>
                </td>
                <td>
                  <div class="filter-date-range">
                    <input type="date" class="filter-input" data-filter="donation_from" title="From">
                    <input type="date" class="filter-input" data-filter="donation_to" title="To">
                    <span class="filter-date-hint" id="hint-donation"></span>
                  </div>
                </td>
                <td>
                  <div class="filter-range">
                    <input type="number" class="filter-input" data-filter="total_donated_min" placeholder="Min" step="0.01">
                    <input type="number" class="filter-input" data-filter="total_donated_max" placeholder="Max" step="0.01">
                    <span class="filter-date-hint" id="hint-donated"></span>
                  </div>
                </td>
              </tr>
            </thead>
            <tbody id="search-tbody"></tbody>
          </table>
        </div>
        <div id="search-pagination"></div>
      </section>

      <!-- IMPORT PAGE -->
      <section id="page-import" class="page">
        <div class="import-section">
          <div id="import-step1">
            <h2>Import Contacts</h2>
            <p>Upload a CSV or Excel file to import contacts.</p>
            <div class="drop-zone" id="drop-zone">
              <p>Drag & drop a file here, or click to select</p>
              <p class="drop-hint">Accepts .csv and .xlsx files</p>
              <input type="file" id="import-file" accept=".csv,.xlsx" hidden>
            </div>
            <button id="btn-upload-preview" class="btn btn-primary" disabled>Upload & Preview</button>
          </div>

          <div id="import-step2" class="hidden">
            <h2>Preview & Map Columns</h2>
            <p id="import-summary"></p>
            <div class="preview-table-wrap">
              <table class="preview-table" id="preview-table"></table>
            </div>
            <button id="btn-import-execute" class="btn btn-primary">Import Contacts</button>
            <button id="btn-import-back" class="btn">Back</button>

            <div class="import-preview-section">
              <h3>Import Preview</h3>
              <p class="import-preview-hint">This is how your contacts will appear after import.</p>
              <div class="import-preview-table-wrap">
                <table class="search-table import-preview-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>City</th>
                      <th>State</th>
                      <th>Organization</th>
                      <th>Relationship</th>
                      <th>Tags</th>
                      <th>Last Contact</th>
                      <th>Last Donation</th>
                      <th>Total Donated</th>
                    </tr>
                  </thead>
                  <tbody id="import-preview-tbody"></tbody>
                </table>
              </div>
            </div>
          </div>

          <div id="import-step-duplicates" class="hidden">
            <h2>Potential Duplicates Found</h2>
            <p id="import-dup-summary"></p>
            <div class="dup-toolbar">
              <div class="dup-toolbar-left">
                <label style="font-size:13px;cursor:pointer;">
                  <input type="checkbox" id="import-dup-select-all" checked> Select all
                </label>
              </div>
              <div class="dup-toolbar-right">
                <button id="btn-import-selected-dups" class="btn btn-primary btn-sm">Import Selected</button>
                <button id="btn-skip-all-dups" class="btn btn-sm">Skip All &amp; Finish</button>
              </div>
            </div>
            <div id="import-dup-list"></div>
            <div id="import-dup-pagination"></div>
          </div>

          <div id="import-step3" class="hidden">
            <h2>Import Complete</h2>
            <div id="import-results"></div>
            <button id="btn-import-another" class="btn">Import Another File</button>
            <button id="btn-goto-contacts" class="btn btn-primary">Go to Contacts</button>
          </div>
        </div>
      </section>

      <!-- SETTINGS PAGE -->
      <section id="page-settings" class="page">
        <div class="settings-section">
          <h2>Settings</h2>
          <form id="settings-form">
            <div class="form-group">
              <label for="setting-name">Your Name</label>
              <input type="text" id="setting-name" placeholder="Your full name">
            </div>
            <div class="form-group">
              <label for="setting-context">Mission Context</label>
              <textarea id="setting-context" rows="4" placeholder="Describe your mission, ministry, or organization in a few sentences. This helps the AI write more personalized messages."></textarea>
            </div>
            <div class="form-group">
              <label for="setting-stale-days">Default Stale Contact Threshold (days)</label>
              <input type="number" id="setting-stale-days" value="90" min="1">
              <small>Contacts with no outreach in this many days will be flagged.</small>
            </div>
            <button type="submit" class="btn btn-primary">Save Settings</button>
            <div id="settings-message" class="hidden"></div>
          </form>

          <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--gray-200);">

          <div class="gmail-section">
            <h3 style="margin-bottom: 8px;">Gmail Integration</h3>
            <p style="color: var(--gray-400); font-size: 14px; margin-bottom: 12px;">Connect your Gmail account to send emails directly from MissionReach instead of opening your email client.</p>
            <div id="gmail-status" style="display:flex;align-items:center;gap:12px;padding:12px;background:var(--gray-50);border-radius:8px;margin-bottom:12px;">
              <span id="gmail-status-text" style="font-size:14px;color:var(--gray-500);">Checking Gmail status...</span>
            </div>
            <div id="gmail-actions" style="display:flex;gap:8px;">
              <a id="btn-gmail-connect" class="btn btn-primary btn-sm hidden" href="api/gmail/connect">Connect Gmail</a>
              <button id="btn-gmail-disconnect" class="btn btn-sm hidden" type="button">Disconnect Gmail</button>
            </div>
          </div>

          <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--gray-200);">

          <div class="tag-manage-section">
            <h3 style="margin-bottom: 8px;">Manage Tags</h3>
            <p style="color: var(--gray-400); font-size: 14px; margin-bottom: 12px;">Add or remove tags available for tagging contacts. Tags currently assigned to contacts cannot be removed.</p>
            <div class="tag-manage-add-row">
              <input type="text" id="tag-manage-input" placeholder="New tag name...">
              <button type="button" class="btn btn-primary btn-sm" id="btn-add-tag">Add Tag</button>
            </div>
            <div class="tag-manage-list" id="tag-manage-list"></div>
            <div id="tag-manage-status" class="hidden" style="margin-top: 8px;"></div>
          </div>

        </div>
      </section>

      <!-- PROFILE PAGE -->
      <section id="page-profile" class="page">
        <div class="settings-section">
          <h2>Profile</h2>

          <div id="profile-user-info" style="margin-bottom: 24px; padding: 16px; background: var(--gray-50); border-radius: 8px;">
            <p style="font-size: 16px; font-weight: 600; color: var(--gray-800); margin-bottom: 4px;" id="profile-display-name"></p>
            <p style="font-size: 13px; color: var(--gray-500);">
              <span id="profile-username"></span> &middot; <span id="profile-email"></span>
            </p>
          </div>

          <hr style="margin: 24px 0; border: none; border-top: 1px solid var(--gray-200);">

          <h3 style="margin-bottom: 8px;">Change Password</h3>
          <form id="profile-change-password-form">
            <div class="form-group">
              <label for="profile-current-password">Current Password</label>
              <input type="password" id="profile-current-password" autocomplete="current-password">
            </div>
            <div class="form-group">
              <label for="profile-new-password">New Password</label>
              <input type="password" id="profile-new-password" autocomplete="new-password">
              <small>Minimum 6 characters.</small>
            </div>
            <div class="form-group">
              <label for="profile-confirm-password">Confirm New Password</label>
              <input type="password" id="profile-confirm-password" autocomplete="new-password">
            </div>
            <button type="submit" class="btn btn-primary">Update Password</button>
            <div id="profile-password-message" class="hidden"></div>
          </form>

          <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--gray-200);">

          <h3 style="margin-bottom: 8px;">AI Query History</h3>
          <p style="color: var(--gray-400); font-size: 14px; margin-bottom: 12px;">Your past AI-generated outreach recommendations.</p>
          <div id="ai-history-list"></div>
          <div id="ai-history-pagination"></div>

          <hr style="margin: 32px 0; border: none; border-top: 1px solid var(--gray-200);">

          <h3 style="margin-bottom: 8px; color: var(--red-700);">Delete Account</h3>
          <div style="padding: 16px; background: var(--red-50); border: 1px solid var(--red-100); border-radius: 8px; margin-bottom: 12px;">
            <p style="font-size: 14px; color: var(--red-700); font-weight: 500; margin-bottom: 4px;">This action is permanent and cannot be undone.</p>
            <p style="font-size: 13px; color: var(--gray-500);">All your contacts, donations, outreach history, and AI prompts will be permanently deleted.</p>
          </div>
          <button type="button" class="btn btn-danger" id="btn-delete-account">Delete My Account</button>
          <div id="profile-delete-message" class="hidden"></div>
        </div>
      </section>

      <!-- ADMIN PAGE -->
      <section id="page-admin" class="page">
        <div class="settings-section" style="max-width: 800px;">
          <h2>User Management</h2>
          <p style="color: var(--gray-400); font-size: 14px; margin-bottom: 16px;">Create, edit, and delete user accounts. Each user has their own isolated data.</p>

          <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;padding:12px;background:var(--gray-50);border-radius:8px;">
            <label for="admin-allow-registration" style="font-weight:600;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:8px;">
              <input type="checkbox" id="admin-allow-registration">
              Allow self-registration
            </label>
            <span style="color:var(--gray-400);font-size:13px;">When enabled, anyone can create an account from the login page.</span>
          </div>

          <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;padding:12px;background:var(--gray-50);border-radius:8px;">
            <label for="admin-model-select" style="font-weight:600;font-size:14px;white-space:nowrap;">AI Model</label>
            <select id="admin-model-select" style="padding:6px 10px;border:1px solid var(--gray-200);border-radius:6px;font-size:14px;">
              <option value="haiku">Claude Haiku (fastest, lowest cost)</option>
              <option value="sonnet">Claude Sonnet (balanced)</option>
              <option value="opus">Claude Opus (most capable)</option>
            </select>
            <span style="color:var(--gray-400);font-size:13px;">Choose which Claude model generates recommendations for all users.</span>
          </div>

          <button id="btn-add-user" class="btn btn-primary" style="margin-bottom: 16px;">Add New User</button>

          <div id="admin-user-form-wrap" class="hidden" style="margin-bottom: 24px;">
            <div class="admin-user-form-card">
              <h3 id="admin-form-title">Add User</h3>
              <form id="admin-user-form">
                <input type="hidden" id="admin-user-id">
                <div class="form-group">
                  <label for="admin-username">Username</label>
                  <input type="text" id="admin-username" required>
                </div>
                <div class="form-group">
                  <label for="admin-email">Email</label>
                  <input type="email" id="admin-email" required>
                </div>
                <div class="form-group" id="admin-password-group">
                  <label for="admin-password">Reset Password</label>
                  <input type="password" id="admin-password" autocomplete="new-password">
                  <small id="admin-password-hint">Minimum 6 characters.</small>
                </div>
                <div class="form-group" id="admin-default-password-note">
                  <small style="color: var(--gray-500);">New users will be assigned the default password <strong>password123</strong> and will be required to change it on first login.</small>
                </div>
                <div class="form-group">
                  <label for="admin-display-name">Display Name</label>
                  <input type="text" id="admin-display-name">
                </div>
                <div class="form-group">
                  <label for="admin-role">Role</label>
                  <select id="admin-role">
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                  </select>
                </div>
                <div style="display:flex;gap:8px;">
                  <button type="submit" class="btn btn-primary">Save</button>
                  <button type="button" class="btn" id="btn-cancel-user">Cancel</button>
                </div>
                <div id="admin-form-message" class="hidden" style="margin-top: 8px;"></div>
              </form>
            </div>
          </div>

          <table class="admin-users-table" id="admin-users-table">
            <thead>
              <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Display Name</th>
                <th>Role</th>
                <th>Created</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="admin-users-tbody"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- CONTACT DETAIL MODAL -->
  <div id="contact-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h2 id="modal-title">Contact Details</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <!-- OUTREACH LOG MODAL -->
  <div id="outreach-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel modal-sm">
      <div class="modal-header">
        <h2>Log Outreach</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="outreach-form">
          <input type="hidden" id="outreach-contact-id">
          <input type="hidden" id="outreach-contact-email">
          <div class="form-group">
            <label for="outreach-mode">Mode</label>
            <select id="outreach-mode">
              <option value="email">Email</option>
              <option value="sms">SMS</option>
              <option value="call">Call</option>
              <option value="letter">Letter</option>
              <option value="in_person">In Person</option>
              <option value="social_media">Social Media</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="outreach-subject">Subject</label>
            <input type="text" id="outreach-subject">
          </div>
          <div class="form-group">
            <label for="outreach-content">Content</label>
            <textarea id="outreach-content" rows="4"></textarea>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
            <button type="submit" class="btn btn-primary">Log Outreach</button>
            <a id="btn-send-email" class="btn send-email-btn hidden" href="#" target="_blank" title="Open in your email client">Send Email</a>
            <button type="button" class="btn" id="btn-generate-outreach">Generate Recommended Outreach</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- IDLE TIMEOUT WARNING MODAL -->
  <div id="idle-timeout-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-panel modal-sm idle-timeout-panel">
      <div class="modal-header">
        <h2>Session Timeout Warning</h2>
      </div>
      <div class="modal-body" style="text-align:center;">
        <p style="margin-bottom:16px;color:var(--gray-600);font-size:15px;">You have been inactive and will be automatically logged out in:</p>
        <div class="idle-timeout-countdown" id="idle-timeout-seconds">60</div>
        <p style="margin-bottom:24px;color:var(--gray-500);font-size:14px;">seconds</p>
        <button class="btn btn-primary" id="btn-stay-logged-in" style="width:100%;justify-content:center;padding:12px;font-size:15px;">Stay Logged In</button>
      </div>
    </div>
  </div>

  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/home.js"></script>
  <script src="js/contacts.js"></script>
  <script src="js/search.js"></script>
  <script src="js/import.js"></script>
  <script src="js/settings.js"></script>
  <script src="js/profile.js"></script>
  <script src="js/admin.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
